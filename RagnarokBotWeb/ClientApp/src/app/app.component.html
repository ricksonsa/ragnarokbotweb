<nz-layout class="app-layout" *ngIf="logged">
  <nz-sider [nzTheme]="darkMode ? 'dark': 'light'" class="menu-sidebar" nzCollapsible nzWidth="256px" nzBreakpoint="md"
    [(nzCollapsed)]="isCollapsed" [nzTrigger]="null">
    <div class="sidebar-logo">
      <a href="/" target="_blank">
        <img src="assets/images/ragnarok-logo-transparent.png" alt="logo">
        <h1 [ngClass]="{'top-actions-button-light': !darkMode}" nz-typography>{{ account?.server?.name ?? 'The SCUM Bot'
          }}</h1>
      </a>
    </div>
    <ul nz-menu [nzTheme]="darkMode ? 'dark': 'light'" nzMode="inline" [nzInlineCollapsed]="isCollapsed">

      <li nz-submenu nzOpen nzTitle="Dashboard" nzIcon="dashboard">
        <ul>
          <li nz-menu-item nzMatchRouter>
            <a routerLink="dashboard/home">Home</a>
          </li>
          <li nz-menu-item nzMatchRouter [nzDisabled]="account.server?.ftp == null">
            <a routerLink="dashboard/logs">Logs</a>
          </li>
          <li nz-menu-item nzMatchRouter [nzDisabled]="account.server?.ftp == null">
            <a routerLink="dashboard/payments">Payments</a>
          </li>
          <!-- <li nz-menu-item nzMatchRouter>
            <a routerLink="dashboard/console">Console (Coming Soon)</a>
          </li> -->
        </ul>
      </li>

      <li nz-submenu nzOpen nzTitle="Settings" nzIcon="form">
        <ul>
          <li nz-menu-item nzMatchRouter>
            <a routerLink="settings/server">Server</a>
          </li>
          <li nz-menu-item nzMatchRouter [nzDisabled]="account.server?.ftp == null">
            <a routerLink="settings/discord">Discord</a>
          </li>

          <li nz-menu-item nzMatchRouter [nzDisabled]="account.server?.discord == null">
            <a routerLink="settings/kill-feed">Kill Feed</a>
          </li>

          <!-- <li nz-menu-item nzMatchRouter>
            <a routerLink="settings/rankings">Rankings (Coming Soon)</a>
          </li> -->
        </ul>
      </li>

      <li nz-submenu nzOpen nzTitle="Management" nzIcon="user">
        <ul>
          <li nz-menu-item nzMatchRouter [nzDisabled]="account.server?.discord == null">
            <a routerLink="management/players">Players</a>
          </li>
          <!-- <li nz-menu-item nzMatchRouter [nzDisabled]="account.server?.discord == null">
            <a routerLink="management/tickets">Tickets (Coming Soon)</a>
          </li> -->
        </ul>
      </li>

      <li nz-submenu nzOpen nzTitle="Shop" nzIcon="dollar-circle">
        <ul>
          <li nz-menu-item nzMatchRouter [nzDisabled]="account.server?.discord == null">
            <a routerLink="shop/welcome-pack">Welcome Pack</a>
          </li>
          <li nz-menu-item nzMatchRouter [nzDisabled]="account.server?.discord == null">
            <a routerLink="shop/orders">Orders</a>
          </li>
          <li nz-menu-item nzMatchRouter [nzDisabled]="account.server?.discord == null">
            <a routerLink="shop/packages">Packages</a>
          </li>
          <li *ngIf="account.accessLevel > 0" nz-menu-item nzMatchRouter>
            <a routerLink="shop/items">Items (Admin)</a>
          </li>
          <li nz-menu-item nzMatchRouter [nzDisabled]="account.server?.discord == null">
            <a routerLink="shop/uav">UAV</a>
          </li>
          <!-- <li nz-menu-item nzMatchRouter [nzDisabled]="account.server?.discord == null">
            <a>Taxi (Coming Soon)</a>
          </li> -->
        </ul>
      </li>

      <li nz-submenu nzOpen nzTitle="Events" nzIcon="star">
        <ul>
          <!-- <li nz-menu-item nzMatchRouter [nzDisabled]="account.server?.discord == null">
            <a>Air Drops (Coming Soon)</a>
          </li> -->
          <li nz-menu-item nzMatchRouter [nzDisabled]="account.server?.discord == null">
            <a routerLink="events/warzones">Warzones</a>
          </li>
          <li nz-menu-item nzMatchRouter [nzDisabled]="account.server?.discord == null">
            <a routerLink="events/quests">Quests</a>
          </li>
        </ul>
      </li>

      <li nz-submenu nzOpen nzTitle="Scheduled Tasks" nzIcon="clock-circle">
        <ul>
          <li nz-menu-item nzMatchRouter [nzDisabled]="account.server?.discord == null">
            <a routerLink="scheduled-tasks/default">Default (Coming Soon)</a>
          </li>
          <li nz-menu-item nzMatchRouter [nzDisabled]="account.server?.discord == null">
            <a routerLink="scheduled-tasks/custom">Custom (Coming Soon)</a>
          </li>
        </ul>
      </li>
    </ul>
  </nz-sider>
  <nz-layout>
    <!-- <nz-header [ngClass]="{'header-light': !darkMode}"> -->
    <nz-header>
      <div class="app-header">
        <span class="header-trigger" (click)="isCollapsed = !isCollapsed">
          <nz-icon class="trigger" [nzType]="isCollapsed ? 'menu-unfold' : 'menu-fold'" />
        </span>
      </div>
      <div class="top-actions">
        <!-- <ng-template #light>
          <nz-icon nzType="sun" nzTheme="outline" />
        </ng-template>
        <ng-template #dark>
          <nz-icon nzType="moon" nzTheme="outline" />
        </ng-template>

        <nz-switch style="margin-right: 10px;" [(ngModel)]="darkMode" (ngModelChange)="changeTheme($event)"
          [nzCheckedChildren]="dark" [nzUnCheckedChildren]="light"></nz-switch> -->

        <button nz-popconfirm [nzPopconfirmTitle]="topActions" nzPopconfirmOverlayClassName="top-actions-popconfirm"
          nz-button nzType="link" style="height: 40px;">
          <nz-space nzAlign="center">
            <nz-avatar *nzSpaceItem [nzText]="getFirstLetter(account?.name)"
              style="color:#f56a00; background-color:#fde3cf;"></nz-avatar>
            <p *nzSpaceItem style="margin: 0" class="top-actions-button"
              [ngClass]="{'top-actions-button-dark': darkMode}">{{account?.name}}</p>
          </nz-space>
          <ng-template #topActions>
            <nz-space nzDirection="vertical" nzAlign="start">
              <button *nzSpaceItem nz-button nzType="link" class="top-action" routerLink="/profile">
                <nz-icon nzType="user" nzTheme="outline" /> Profile
              </button>
              <button *nzSpaceItem nz-button nzType="link" [nzDanger]="true" class="top-action" (click)="logout()">
                <nz-icon nzType="logout" nzTheme="outline" /> Logout
              </button>
            </nz-space>
          </ng-template>
        </button>
      </div>
    </nz-header>
    <nz-content>
      <!-- <div *ngIf="block" class="block"></div> -->

      <div class="inner-content">
        <div class="alert-holder" *ngIf="showAlert">
          <nz-affix [nzOffsetTop]="10">
            <nz-alert *ngIf="showAlert && alert" [nzDescription]="alert.message" [nzMessage]="alert.title"
              [nzType]="alert.type!"></nz-alert>
          </nz-affix>
        </div>
        <!-- <nz-affix [nzOffsetBottom]="5" [nzOffsetTop]="10">
          <nz-breadcrumb style="margin-bottom: 20px;">
            @for (path of paths; track $index) {
            <nz-breadcrumb-item style="text-transform: capitalize;">{{path}}</nz-breadcrumb-item>
            }

          </nz-breadcrumb>
        </nz-affix> -->

        <router-outlet></router-outlet>
      </div>
    </nz-content>
  </nz-layout>
</nz-layout>


<div class="login" *ngIf="!logged && !register">
  <nz-card class="login-container">
    <div class="logo-holder">
      <img width="48" height="48" src="assets/images/ragnarok-logo-transparent.png" alt="">
      <h4 style="margin: 0;" nz-typography>The SCUM Bot</h4>
    </div>
    <p nz-typography> Manage your SCUM private server with automation tools and insights
      powered by The SCUM Bot. Log in to configure events, spawns, and more.</p>
    <br>
    <form nz-form [formGroup]="loginForm">
      <nz-space style="width: 100%;" nzDirection="vertical">
        <p style="margin: 0; text-align: start;" *nzSpaceItem nz-typography>E-mail</p>
        <nz-form-item *nzSpaceItem>
          <nz-form-control [nzSpan]="24" nzErrorTip="Email is required!">
            <input formControlName="email" nz-input name="email" type="email" id="email" />
          </nz-form-control>
        </nz-form-item>

        <p style="margin: 0; text-align: start;" *nzSpaceItem nz-typography>Password</p>
        <nz-form-item *nzSpaceItem>
          <nz-form-control [nzSpan]="24" nzErrorTip="Password is required!">
            <input nz-input formControlName="password" name="password" type="password" id="password" />
          </nz-form-control>
        </nz-form-item>

        <div *nzSpaceItem>
          <ng-container *ngTemplateOutlet="error"></ng-container>
        </div>

        <button *nzSpaceItem nz-button type="button" nzType="link" (click)="register = true">Don't have an account?
          Sign up one here</button>
        <button *nzSpaceItem (click)="login()" [nzBlock]="true" nz-button nzType="primary" nzSize="large"
          [nzLoading]="loading">Sign
          In</button>
      </nz-space>
    </form>
  </nz-card>
</div>

<div class="login" *ngIf="!logged && register">
  <nz-card class="login-container">
    <div class="logo-holder">
      <img width="48" height="48" src="assets/images/ragnarok-logo-transparent.png" alt="">
      <h4 style="margin: 0;" nz-typography>The SCUM Bot</h4>
    </div>
    <h5 nz-typography>Sign Up</h5>
    <br>
    <form nz-form [formGroup]="registerForm" (action)="signup()">
      <!-- <nz-space style="width: 100%;" nzDirection="vertical"> -->
      <p style="margin: 0; text-align: start;" nz-typography>Name</p>
      <nz-form-item>
        <nz-form-control [nzSpan]="24" nzErrorTip="Name is required!">
          <input formControlName="name" nz-input name="name" type="text" id="name" />
        </nz-form-control>
      </nz-form-item>

      <p style="margin: 0; text-align: start;" nz-typography>E-mail</p>
      <nz-form-item>
        <nz-form-control [nzSpan]="24" nzErrorTip="Email is required!">
          <input formControlName="email" nz-input name="email" type="email" id="email" />
        </nz-form-control>
      </nz-form-item>

      <p style="margin: 0; text-align: start;" nz-typography>Password</p>
      <nz-form-item>
        <nz-form-control [nzSpan]="24" nzErrorTip="Password is required!">
          <input formControlName="password" nz-input name="password" type="password" id="password" />
        </nz-form-control>
      </nz-form-item>

      <p style="margin: 0; text-align: start;" nz-typography>Confirm password</p>
      <nz-form-item>
        <nz-form-control [nzSpan]="24" nzErrorTip="Password Confirmation is required!">
          <input formControlName="confirmPassword" nz-input name="confirmPassword" type="password"
            id="confirmPassword" />
        </nz-form-control>
      </nz-form-item>

      <p style="margin: 0; text-align: start;" nz-typography>Country</p>
      <nz-form-item>
        <nz-form-control nzErrorTip="Country is required!" [nzSpan]="24">
          <nz-select nzSize="large" id="country" nzPlaceHolder="Select your country" formControlName="country"
            nzShowSearch>
            @for (country of countries; track $index) {
            <nz-option [nzValue]="country.name" [nzLabel]="country.name"></nz-option>
            }
          </nz-select>
        </nz-form-control>
      </nz-form-item>

      <div>
        <ng-container *ngTemplateOutlet="error"></ng-container>
      </div>

      <nz-space nzDirection="vertical" style="width: 100%;">
        <button *nzSpaceItem nz-button type="button" [nzBlock]="true" nzType="link" (click)="register = false">
          Already have an account? Sign In
        </button>
        <button *nzSpaceItem (click)="signup()" [nzLoading]="loading" [nzBlock]="true" nz-button nzType="primary"
          nzSize="large">Sign
          Up</button>
      </nz-space>
      <!-- </nz-space> -->
    </form>
  </nz-card>
</div>

<ng-template #error>
  <nz-alert *ngIf="errorMessage" nzType="error" nzCloseable [nzMessage]="errorMessage"
    (nzOnClose)="errorMessage = undefined"></nz-alert>
</ng-template>